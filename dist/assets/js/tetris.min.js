"use strict";var _slicedToArray=function(){function l(l,a){var t=[],n=!0,e=!1,i=void 0;try{for(var r,o=l[Symbol.iterator]();!(n=(r=o.next()).done)&&(t.push(r.value),!a||t.length!==a);n=!0);}catch(l){e=!0,i=l}finally{try{!n&&o.return&&o.return()}finally{if(e)throw i}}return t}return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return l(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();$(function(){var l=function(l,a,t){for(var n=new Array(l),e=0;e<l;e++){n[e]=new Array(a);for(var i=0;i<a;i++)n[e][i]=t}return n},a=function(a){for(var t=a.length,n=a[0].length,e=l(t,n,0),i=0;i<t;i++)for(var r=0;r<n;r++)e[i][r]=a[i][r];return e},t=void 0,n=void 0,e=void 0,i=void 0,r=void 0,o=void 0,f=void 0,s=void 0,d=void 0,c=void 0,v=void 0,u=void 0,_=void 0,h=void 0,y=void 0,m=void 0,p=void 0,g=void 0,b=void 0,k='<div class="board-cell" name="1"></div>',q='<div class="board-cell-0" name="0"></div>',A=function(l,a){var t="";if(2===l&&2===a)t="fall_2_2";else if(2===l&&3===a)t="fall_2_3";else if(3===l&&2===a)t="fall_3_2";else if(4===l&&1===a)t="fall_4_1";else{if(1!==l||4!==a)return;t="fall_1_4"}return t},C=function(l){for(var a=l.length,t=l[0].length,n=A(a,t),e="",i=0;i<a;i++){for(var r="<li>",o=0;o<t;o++)r=0===l[i][o]?r.concat(q):r.concat(k);e=e.concat(r).concat("</li>")}var f="<ul class="+n+">\n\t\t\t\t\t"+e+"\n\t\t\t\t\t</ul>";return f},w=l(2,3,1);w[0][0]=0,w[1][2]=0,t={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][1]=0,w[2][0]=0,n={fall_style:C(w),fall_data:w},w=l(2,3,1),w[0][2]=0,w[1][0]=0,e={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][0]=0,w[2][1]=0,i={fall_style:C(w),fall_data:w},w=l(1,4,1),r={fall_style:C(w),fall_data:w},w=l(4,1,1),o={fall_style:C(w),fall_data:w},w=l(2,3,1),w[1][1]=0,w[1][2]=0,f={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][1]=0,w[1][1]=0,s={fall_style:C(w),fall_data:w},w=l(2,3,1),w[0][1]=0,w[0][2]=0,d={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][0]=0,w[1][0]=0,c={fall_style:C(w),fall_data:w},w=l(2,3,1),w[1][1]=0,w[1][0]=0,v={fall_style:C(w),fall_data:w},w=l(3,2,1),w[1][1]=0,w[2][1]=0,u={fall_style:C(w),fall_data:w},w=l(2,3,1),w[0][1]=0,w[0][0]=0,_={fall_style:C(w),fall_data:w},w=l(3,2,1),w[1][0]=0,w[2][0]=0,h={fall_style:C(w),fall_data:w},w=l(2,2,1),y={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][0]=0,w[2][0]=0,m={fall_style:C(w),fall_data:w},w=l(2,3,1),w[0][0]=0,w[0][2]=0,p={fall_style:C(w),fall_data:w},w=l(3,2,1),w[0][1]=0,w[2][1]=0,g={fall_style:C(w),fall_data:w},w=l(2,3,1),w[1][0]=0,w[1][2]=0,b={fall_style:C(w),fall_data:w};var x=[t,n,e,i],I=[r,o],M=[f,s,d,c,v,u,_,h],T=[y],F=[m,p,g,b],N=[x,I,M,T,F],S=null,j=null,E=[0,0],O=0,z=null,B=function(){z=l(12,10,0);for(var a="",t="",n=0;n<z[0].length;n++)a+='<div class="board-cell-init"></div>';for(var e=0;e<z.length;e++)t+="<li>"+a+"</li>";$(".board ul").html(t)},D=function(l){var a=0;return a=3===l?0:0===l||4===l?Math.floor(4*Math.random()):1===l?Math.floor(2*Math.random()):Math.floor(8*Math.random())},G=function(){if(0!==z[0][3]||0!==z[0][4]||0!==z[0][5])return clearInterval(J),W(),void $(".score").removeClass("hide");S=[-1,3];var l=Math.floor(5*Math.random()),a=D(l);E=[l,a],$(".fall").css({left:"120px",bottom:"480px"});var t=N[l][a];$(".fall").html(t.fall_style),j=t.fall_data},H=function(l){var a=$(l).css("bottom");null!==a&&""!==a&&"none"!==a&&void 0!==a||(a=0),a=Number.parseFloat(/\-*[0-9]+/g.exec(a)[0]);var t=S,n=_slicedToArray(t,2),e=n[0],i=n[1];S=[e+1,i],$(l).animate({bottom:a-40+"px"},200,function(){})},J=null,K=function(l){J=setInterval(function(){var a=S,t=_slicedToArray(a,2),n=t[0],e=t[1],i=[n+1,e];L(z,j,i)===!1&&n<11?H(l):(z=P(z,j,S),G())},1200)},L=function(l,t,n){var e=a(l),i=_slicedToArray(n,2),r=i[0],o=i[1],f=t.length,s=t[0].length;if(!(r<12&&o+s-1<10&&o>-1))return!0;for(var d=0;d<f;d++){var c=r-(f-1-d);if(c>-1)for(var v=0;v<s;v++){var u=o+v;e[c][u]+=t[d][v]}}for(var _=0;_<e.length;_++)for(var h=0;h<e[0].length;h++)if(e[_][h]>1)return!0;return!1},P=function(l,t,n){for(var e=a(l),i=a(l),r=n[0],o=n[1],f=t.length,s=t[0].length,d=0;d<f;d++){var c=r-(f-1-d);if(c>-1)for(var v=0;v<s;v++){var u=o+v;i[c][u]+=t[d][v]}}var _=function(){for(var a=0;a<l.length;a++)for(var t=0;t<l[0].length;t++)if(i[a][t]-e[a][t]!==0){var n=$(".board ul").find("li"),r=$(n[a]).find("div");$(r[t]).removeClass("board-cell-init").addClass("board-cell")}};_();for(var h=function(){$(".board ul li").eq(11).remove();for(var a="<li>",t=0;t<l[0].length;t++)a+='<div class="board-cell-init"></div>';a+="</li>",$(".board ul").prepend(a)},y=function(){for(var l=0,a=i.length,t=i[0].length,n=0;n<t;n++){if(0===i[a-1][n])return l=0,!1;l=1}if(1===l){for(var e=a-1;e>0;e--)i[e]=i[e-1];i[0]=[0,0,0,0,0,0,0,0,0,0],h()}return!0};y()===!0;);return i},Q=function(l){for(var a=l[0],t=l[1],n=D(a);n===t&&3!==a;)n=D(a);var e=N[a][n],i=e.fall_data;L(z,i,S)===!1&&(j=e.fall_data,$(".fall").html(e.fall_style),l[1]=n)},R=function(l,a){var t=S,n=_slicedToArray(t,2),e=n[0],i=n[1],r=$(l).css("left");null!==r&&""!==r&&"none"!==r&&void 0!==r||(r=0),r=Number.parseFloat(/.*[0-9]+/g.exec(r)[0]);var o=j[0].length;if("left"===a&&i-1>-1){var f=[e,i-1];if(L(z,j,f)===!0)return;S=[e,i-1],$(l).animate({left:r-40+"px"},100,function(){})}else{if(!("right"===a&&i+o<10))return;var s=[e,i+1];if(L(z,j,s)===!0)return;S=[e,i+1],$(l).animate({left:r+40+"px"},100,function(){})}},U=function(){$(".fall").stop();for(var l=S,a=_slicedToArray(l,2),t=a[0],n=a[1],e=[t+1,n],i=0;L(z,j,e)===!1&&t<11;){S=[t+1,n],i+=1;var r=S,o=_slicedToArray(r,2);t=o[0],n=o[1],e=[t+1,n]}z=P(z,j,S),G()},V=function l(){$(document).on("keydown","body",function(l){37===l.keyCode?R($(".fall"),"left"):39===l.keyCode?R($(".fall"),"right"):38===l.keyCode?Q(E):40===l.keyCode?U():32===l.keyCode?clearInterval(J):13===l.keyCode&&(clearInterval(J),K($(".fall")))}),$(document).on("click",".move_left",function(){R($(".fall"),"left",l)}).on("click",".move_right",function(){R($(".fall"),"right",l)}).on("click",".move_change",function(){Q(E)}).on("click",".move_down",function(){0===O&&U()}).on("click",".pause_start",function(){"0"===$(".stop_restart span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("img").eq(2).css({display:"block"})):($(this).find("img").eq(2).css({display:"none"}),"0"===$(this).find("span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"block"}),clearInterval(J),K($(".fall")),$(this).find("span").html("1")):($(this).find("img").eq(0).css({display:"block"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("span").html("0"),clearInterval(J)))})},W=function(){$(document).off("keydown","body"),$(document).off("click",".move_left"),$(document).off("click",".move_right"),$(document).off("click",".move_change"),$(document).off("click",".move_down"),$(document).off("click",".pause_start")},X=function(){B(),G(),K($(".fall")),$(".score").addClass("hide")},Y=function(){B(),G(),clearInterval(J)},Z=function(){$(document).on("click",".stop_restart",function(){"0"===$(this).find("span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"block"}),$(this).find("span").html("1"),$(".pause_start img").eq(0).css({display:"none"}),$(".pause_start img").eq(1).css({display:"block"}),$(".pause_start img").eq(2).css({display:"none"}),$(".pause_start span").html("1"),X(),V()):($(this).find("img").eq(0).css({display:"block"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("span").html("0"),$(".pause_start img").eq(0).css({display:"none"}),$(".pause_start img").eq(1).css({display:"none"}),$(".pause_start img").eq(2).css({display:"block"}),W(),Y())})};Z()});