"use strict";var _slicedToArray=function(){function l(l,a){var t=[],r=!0,o=!1,e=void 0;try{for(var n,f=l[Symbol.iterator]();!(r=(n=f.next()).done)&&(t.push(n.value),!a||t.length!==a);r=!0);}catch(l){o=!0,e=l}finally{try{!r&&f.return&&f.return()}finally{if(o)throw e}}return t}return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return l(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();$(function(){var l=function(l,a,t){for(var r=new Array(l),o=0;o<l;o++){r[o]=new Array(a);for(var e=0;e<a;e++)r[o][e]=t}return r},a=function(a){for(var t=a.length,r=a[0].length,o=l(t,r,0),e=0;e<t;e++)for(var n=0;n<r;n++)o[e][n]=a[e][n];return o},t=void 0,r=void 0,o=void 0,e=void 0,n=void 0,f=void 0,i=void 0,d=void 0,v=void 0,c=void 0,u=void 0,s=void 0,_=void 0,y=void 0,h=void 0,m=void 0,g=void 0,b=void 0,A=void 0,p='<div class="board-cell" name="1"></div>',k='<div class="board-cell-0" name="0"></div>',w=function(l,a){var t="";if(2===l&&2===a)t="fall_2_2";else if(2===l&&3===a)t="fall_2_3";else if(3===l&&2===a)t="fall_3_2";else if(4===l&&1===a)t="fall_4_1";else{if(1!==l||4!==a)return;t="fall_1_4"}return t},x=function(l){for(var a=l.length,t=l[0].length,r=w(a,t),o="",e=0;e<a;e++){for(var n="<li>",f=0;f<t;f++)n=0===l[e][f]?n.concat(k):n.concat(p);o=o.concat(n).concat("</li>")}var i="<ul class="+r+">\n\t\t\t\t\t"+o+"\n\t\t\t\t\t</ul>";return i},C=l(2,3,1);C[0][0]=0,C[1][2]=0,t={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][1]=0,C[2][0]=0,r={fall_style:x(C),fall_data:C},C=l(2,3,1),C[0][2]=0,C[1][0]=0,o={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][0]=0,C[2][1]=0,e={fall_style:x(C),fall_data:C},C=l(1,4,1),n={fall_style:x(C),fall_data:C},C=l(4,1,1),f={fall_style:x(C),fall_data:C},C=l(2,3,1),C[1][1]=0,C[1][2]=0,i={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][1]=0,C[1][1]=0,d={fall_style:x(C),fall_data:C},C=l(2,3,1),C[0][1]=0,C[0][2]=0,v={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][0]=0,C[1][0]=0,c={fall_style:x(C),fall_data:C},C=l(2,3,1),C[1][1]=0,C[1][0]=0,u={fall_style:x(C),fall_data:C},C=l(3,2,1),C[1][1]=0,C[2][1]=0,s={fall_style:x(C),fall_data:C},C=l(2,3,1),C[0][1]=0,C[0][0]=0,_={fall_style:x(C),fall_data:C},C=l(3,2,1),C[1][0]=0,C[2][0]=0,y={fall_style:x(C),fall_data:C},C=l(2,2,1),h={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][0]=0,C[2][0]=0,m={fall_style:x(C),fall_data:C},C=l(2,3,1),C[0][0]=0,C[0][2]=0,g={fall_style:x(C),fall_data:C},C=l(3,2,1),C[0][1]=0,C[2][1]=0,b={fall_style:x(C),fall_data:C},C=l(2,3,1),C[1][0]=0,C[1][2]=0,A={fall_style:x(C),fall_data:C};var M=[t,r,o,e],T=[n,f],I=[i,d,v,c,u,s,_,y],F=[h],N=[m,g,b,A],S=[M,T,I,F,N],j=null,E=null,O=[0,0],q=0,z=null,B=function(){z=l(12,10,0);for(var a="",t="",r=0;r<z[0].length;r++)a+='<div class="board-cell-init"></div>';for(var o=0;o<z.length;o++)t+="<li>"+a+"</li>";$(".board ul").html(t)},D=function(l){var a=0;return a=3===l?0:0===l||4===l?Math.floor(4*Math.random()):1===l?Math.floor(2*Math.random()):Math.floor(8*Math.random())},G=function(){if(0!==z[0][3]||0!==z[0][4]||0!==z[0][5])return console.log("off!!"),clearInterval(J),void W();j=[-1,3];var l=Math.floor(5*Math.random()),a=D(l);O=[l,a],$(".fall").css({left:"120px",bottom:"480px"});var t=S[l][a];$(".fall").html(t.fall_style),E=t.fall_data},H=function(l){var a=$(l).css("bottom");null!==a&&""!==a&&"none"!==a&&void 0!==a||(a=0),a=Number.parseFloat(/\-*[0-9]+/g.exec(a)[0]),q=1,$(l).animate({bottom:a-40+"px"},200,function(){var t=j,r=_slicedToArray(t,2),o=r[0],e=r[1];j=[o+1,e],a=$(l).css("bottom"),q=0})},J=null,K=function(l){J=setInterval(function(){var a=j,t=_slicedToArray(a,2),r=t[0],o=t[1],e=[r+1,o];L(z,E,e)===!1&&r<11?H(l):(z=P(z,E,j),G())},1200)},L=function(l,t,r){var o=a(l),e=_slicedToArray(r,2),n=e[0],f=e[1],i=t.length,d=t[0].length;if(!(n<12&&f+d-1<10&&f>-1))return!0;for(var v=0;v<i;v++){var c=n-(i-1-v);if(c>-1)for(var u=0;u<d;u++){var s=f+u;o[c][s]+=t[v][u]}}for(var _=0;_<o.length;_++)for(var y=0;y<o[0].length;y++)if(o[_][y]>1)return!0;return!1},P=function(l,t,r){for(var o=a(l),e=a(l),n=r[0],f=r[1],i=t.length,d=t[0].length,v=0;v<i;v++){var c=n-(i-1-v);if(c>-1)for(var u=0;u<d;u++){var s=f+u;e[c][s]+=t[v][u]}}var _=function(){for(var a=0;a<l.length;a++)for(var t=0;t<l[0].length;t++)if(e[a][t]-o[a][t]!==0){var r=$(".board ul").find("li"),n=$(r[a]).find("div");$(n[t]).removeClass("board-cell-init").addClass("board-cell")}};return _(),e},Q=function(l){for(var a=l[0],t=l[1],r=D(a);r===t&&3!==a;)r=D(a);var o=S[a][r],e=o.fall_data;L(z,e,j)===!1&&(E=o.fall_data,$(".fall").html(o.fall_style),l[1]=r)},R=function(l,a,t){$(document).off("keydown","body");var r=j,o=_slicedToArray(r,2),e=o[0],n=o[1],f=$(l).css("left");null!==f&&""!==f&&"none"!==f&&void 0!==f||(f=0),f=Number.parseFloat(/.*[0-9]+/g.exec(f)[0]);var i=E[0].length;if("left"===a&&n-1>-1){var d=[e,n-1];if(L(z,E,d)===!0)return void t();$(l).animate({left:f-40+"px"},100,function(){t()}),j=[e,n-1]}else{if(!("right"===a&&n+i<10))return void t();var v=[e,n+1];if(L(z,E,v)===!0)return void t();$(l).animate({left:f+40+"px"},100,function(){t()}),j=[e,n+1]}},U=function(){clearInterval(J);for(var l=j,a=_slicedToArray(l,2),t=a[0],r=a[1],o=[t+1,r],e=0;L(z,E,o)===!1&&t<11;){j=[t+1,r],e+=1;var n=j,f=_slicedToArray(n,2);t=f[0],r=f[1],o=[t+1,r]}z=P(z,E,j),G(),K($(".fall"))},V=function l(){$(document).on("keydown","body",function(a){37===a.keyCode?R($(".fall"),"left",l):39===a.keyCode?R($(".fall"),"right",l):38===a.keyCode&&(console.log("change"),Q(O)),0===q&&(40===a.keyCode?(console.log("down"),U()):32===a.keyCode?clearInterval(J):13===a.keyCode&&(clearInterval(J),K($(".fall"))))})},W=function(){$(document).off("keydown","body")},X=function(){B(),G(),K($(".fall")),V()};X()});