"use strict";var _slicedToArray=function(){function l(l,a){var t=[],n=!0,e=!1,o=void 0;try{for(var i,r=l[Symbol.iterator]();!(n=(i=r.next()).done)&&(t.push(i.value),!a||t.length!==a);n=!0);}catch(l){e=!0,o=l}finally{try{!n&&r.return&&r.return()}finally{if(e)throw o}}return t}return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return l(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();$(function(){var l=function(l,a,t){for(var n=new Array(l),e=0;e<l;e++){n[e]=new Array(a);for(var o=0;o<a;o++)n[e][o]=t}return n},a=function(a){for(var t=a.length,n=a[0].length,e=l(t,n,0),o=0;o<t;o++)for(var i=0;i<n;i++)e[o][i]=a[o][i];return e},t=void 0,n=void 0,e=void 0,o=void 0,i=void 0,r=void 0,f=void 0,s=void 0,c=void 0,d=void 0,v=void 0,u=void 0,_=void 0,y=void 0,h=void 0,m=void 0,g=void 0,p=void 0,k=void 0,b='<div class="board-cell" name="1"></div>',q='<div class="board-cell-0" name="0"></div>',A=function(l,a){var t="";if(2===l&&2===a)t="fall_2_2";else if(2===l&&3===a)t="fall_2_3";else if(3===l&&2===a)t="fall_3_2";else if(4===l&&1===a)t="fall_4_1";else{if(1!==l||4!==a)return;t="fall_1_4"}return t},w=function(l){for(var a=l.length,t=l[0].length,n=A(a,t),e="",o=0;o<a;o++){for(var i="<li>",r=0;r<t;r++)i=0===l[o][r]?i.concat(q):i.concat(b);e=e.concat(i).concat("</li>")}var f="<ul class="+n+">\n\t\t\t\t\t"+e+"\n\t\t\t\t\t</ul>";return f},x=l(2,3,1);x[0][0]=0,x[1][2]=0,t={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][1]=0,x[2][0]=0,n={fall_style:w(x),fall_data:x},x=l(2,3,1),x[0][2]=0,x[1][0]=0,e={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][0]=0,x[2][1]=0,o={fall_style:w(x),fall_data:x},x=l(1,4,1),i={fall_style:w(x),fall_data:x},x=l(4,1,1),r={fall_style:w(x),fall_data:x},x=l(2,3,1),x[1][1]=0,x[1][2]=0,f={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][1]=0,x[1][1]=0,s={fall_style:w(x),fall_data:x},x=l(2,3,1),x[0][1]=0,x[0][2]=0,c={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][0]=0,x[1][0]=0,d={fall_style:w(x),fall_data:x},x=l(2,3,1),x[1][1]=0,x[1][0]=0,v={fall_style:w(x),fall_data:x},x=l(3,2,1),x[1][1]=0,x[2][1]=0,u={fall_style:w(x),fall_data:x},x=l(2,3,1),x[0][1]=0,x[0][0]=0,_={fall_style:w(x),fall_data:x},x=l(3,2,1),x[1][0]=0,x[2][0]=0,y={fall_style:w(x),fall_data:x},x=l(2,2,1),h={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][0]=0,x[2][0]=0,m={fall_style:w(x),fall_data:x},x=l(2,3,1),x[0][0]=0,x[0][2]=0,g={fall_style:w(x),fall_data:x},x=l(3,2,1),x[0][1]=0,x[2][1]=0,p={fall_style:w(x),fall_data:x},x=l(2,3,1),x[1][0]=0,x[1][2]=0,k={fall_style:w(x),fall_data:x};var C=[t,n,e,o],I=[i,r],M=[f,s,c,d,v,u,_,y],T=[h],F=[m,g,p,k],N=[C,I,M,T,F],S=null,j=null,E=[0,0],O=0,z=null,B=function(){z=l(12,10,0);for(var a="",t="",n=0;n<z[0].length;n++)a+='<div class="board-cell-init"></div>';for(var e=0;e<z.length;e++)t+="<li>"+a+"</li>";$(".board ul").html(t)},D=function(l){var a=0;return a=3===l?0:0===l||4===l?Math.floor(4*Math.random()):1===l?Math.floor(2*Math.random()):Math.floor(8*Math.random())},G=function(){if(0!==z[0][3]||0!==z[0][4]||0!==z[0][5])return console.log("off!!"),clearInterval(J),void W();S=[-1,3];var l=Math.floor(5*Math.random()),a=D(l);E=[l,a],$(".fall").css({left:"120px",bottom:"480px"});var t=N[l][a];$(".fall").html(t.fall_style),j=t.fall_data},H=function(l){var a=$(l).css("bottom");null!==a&&""!==a&&"none"!==a&&void 0!==a||(a=0),a=Number.parseFloat(/\-*[0-9]+/g.exec(a)[0]);var t=S,n=_slicedToArray(t,2),e=n[0],o=n[1];S=[e+1,o],console.log(J),$(l).animate({bottom:a-40+"px"},200,function(){console.log("下落完成"),console.log(J)})},J=null,K=function(l){J=setInterval(function(){console.log(this);var a=S,t=_slicedToArray(a,2),n=t[0],e=t[1],o=[n+1,e];console.log("开始下落"),L(z,j,o)===!1&&n<11?H(l):(z=P(z,j,S),G())},1200)},L=function(l,t,n){var e=a(l),o=_slicedToArray(n,2),i=o[0],r=o[1],f=t.length,s=t[0].length;if(!(i<12&&r+s-1<10&&r>-1))return!0;for(var c=0;c<f;c++){var d=i-(f-1-c);if(d>-1)for(var v=0;v<s;v++){var u=r+v;e[d][u]+=t[c][v]}}for(var _=0;_<e.length;_++)for(var y=0;y<e[0].length;y++)if(e[_][y]>1)return!0;return!1},P=function(l,t,n){for(var e=a(l),o=a(l),i=n[0],r=n[1],f=t.length,s=t[0].length,c=0;c<f;c++){var d=i-(f-1-c);if(d>-1)for(var v=0;v<s;v++){var u=r+v;o[d][u]+=t[c][v]}}var _=function(){for(var a=0;a<l.length;a++)for(var t=0;t<l[0].length;t++)if(o[a][t]-e[a][t]!==0){var n=$(".board ul").find("li"),i=$(n[a]).find("div");$(i[t]).removeClass("board-cell-init").addClass("board-cell")}};return _(),o},Q=function(l){for(var a=l[0],t=l[1],n=D(a);n===t&&3!==a;)n=D(a);var e=N[a][n],o=e.fall_data;L(z,o,S)===!1&&(j=e.fall_data,$(".fall").html(e.fall_style),l[1]=n)},R=function(l,a){var t=S,n=_slicedToArray(t,2),e=n[0],o=n[1],i=$(l).css("left");null!==i&&""!==i&&"none"!==i&&void 0!==i||(i=0),i=Number.parseFloat(/.*[0-9]+/g.exec(i)[0]);var r=j[0].length;if("left"===a&&o-1>-1){var f=[e,o-1];if(L(z,j,f)===!0)return;S=[e,o-1],$(l).animate({left:i-40+"px"},100,function(){})}else{if(!("right"===a&&o+r<10))return;var s=[e,o+1];if(L(z,j,s)===!0)return;S=[e,o+1],$(l).animate({left:i+40+"px"},100,function(){})}},U=function(){$(".fall").stop();for(var l=S,a=_slicedToArray(l,2),t=a[0],n=a[1],e=[t+1,n],o=0;L(z,j,e)===!1&&t<11;){S=[t+1,n],o+=1;var i=S,r=_slicedToArray(i,2);t=r[0],n=r[1],e=[t+1,n]}z=P(z,j,S),G()},V=function l(){$(document).on("keydown","body",function(l){37===l.keyCode?R($(".fall"),"left"):39===l.keyCode?R($(".fall"),"right"):38===l.keyCode?Q(E):40===l.keyCode?U():32===l.keyCode?clearInterval(J):13===l.keyCode&&(clearInterval(J),K($(".fall")))}),$(document).on("click",".move_left",function(){R($(".fall"),"left",l)}).on("click",".move_right",function(){R($(".fall"),"right",l)}).on("click",".move_change",function(){Q(E)}).on("click",".move_down",function(){0===O&&U()}).on("click",".pause_start",function(){"0"===$(".stop_restart span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("img").eq(2).css({display:"block"})):($(this).find("img").eq(2).css({display:"none"}),"0"===$(this).find("span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"block"}),clearInterval(J),K($(".fall")),$(this).find("span").html("1")):($(this).find("img").eq(0).css({display:"block"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("span").html("0"),clearInterval(J)))})},W=function(){$(document).off("keydown","body"),$(document).off("click",".move_left"),$(document).off("click",".move_right"),$(document).off("click",".move_change"),$(document).off("click",".move_down"),$(document).off("click",".pause_start")},X=function(){B(),G(),K($(".fall"))},Y=function(){B(),G(),clearInterval(J)},Z=function(){$(document).on("click",".stop_restart",function(){"0"===$(this).find("span").html()?($(this).find("img").eq(0).css({display:"none"}),$(this).find("img").eq(1).css({display:"block"}),$(this).find("span").html("1"),$(".pause_start img").eq(0).css({display:"none"}),$(".pause_start img").eq(1).css({display:"block"}),$(".pause_start img").eq(2).css({display:"none"}),$(".pause_start span").html("1"),X(),V()):($(this).find("img").eq(0).css({display:"block"}),$(this).find("img").eq(1).css({display:"none"}),$(this).find("span").html("0"),$(".pause_start img").eq(0).css({display:"none"}),$(".pause_start img").eq(1).css({display:"none"}),$(".pause_start img").eq(2).css({display:"block"}),W(),Y())})};Z()});